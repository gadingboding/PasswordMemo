# 初始化流程测试指南

## 功能概述

我们已经实现了优化初始化过程的前两个需求：

1. **区分初始化状态的界面** - 系统会自动检测是否已初始化，显示相应的界面
2. **初次使用的多步骤WebDAV配置** - 新用户可以通过多步骤流程设置密码和WebDAV同步

## 重要修复

修复了初始化状态检查的问题：之前的实现在检查初始化状态时会触发初始化过程，导致新用户直接进入登录界面。现在我们只检查存储层而不触发完整初始化，确保新用户正确进入初始化流程。

## 测试步骤

### 1. 测试未初始化状态（新用户）

1. 清除浏览器扩展的本地存储数据
2. 重新加载扩展
3. 应该直接显示初始化流程界面（多步骤设置）

**预期结果：**
- 显示步骤条，包含"主密码"和"WebDAV同步"两个步骤
- 第一步：密码设置界面
- 第二步：WebDAV配置界面（可选择跳过）

### 2. 测试密码设置步骤

1. 在第一步中输入密码
2. 确认密码
3. 点击"下一步"

**预期结果：**
- 密码为空时显示错误提示
- 密码不匹配时显示错误提示
- 密码匹配时进入第二步

### 3. 测试WebDAV配置步骤

#### 3.1 跳过WebDAV配置
1. 点击"跳过此步骤"按钮
2. 点击"完成"

**预期结果：**
- 创建本地密码库
- 完成初始化并进入主界面

#### 3.2 配置WebDAV
1. 点击"配置WebDAV"按钮
2. 输入WebDAV URL、用户名和密码
3. 点击"测试连接"
4. 连接成功后选择是否拉取远程密码库
5. 点击"完成"

**预期结果：**
- 连接测试失败时显示错误信息
- 连接成功后可以配置同步
- 完成初始化并进入主界面

### 4. 测试已初始化状态（现有用户）

1. 完成初始化后，重新加载扩展
2. 应该显示登录界面而非初始化界面

**预期结果：**
- 显示标准的密码输入界面
- 可以输入主密码登录
- 提供"首次使用"链接可以重新进入初始化流程

### 5. 测试国际化

1. 切换语言设置（中文/英文）
2. 检查所有界面文本是否正确显示

**预期结果：**
- 所有文本都根据语言设置正确显示
- 步骤条、按钮、提示信息等都支持国际化

## 核心功能验证

### Core模块功能
- ✅ `PasswordManagerConfig` 接口扩展了 `skipWebDAV` 和 `pullRemoteVault` 选项
- ✅ `initialize()` 方法只在未初始化时执行初始化操作
- ✅ `testWebDAVConnection()` 方法可以测试WebDAV连接

### 前端组件功能
- ✅ `Stepper` 组件显示步骤进度
- ✅ `InitializationFlow` 组件处理多步骤初始化
- ✅ `LoginPage` 自动检测初始化状态并显示相应界面
- ✅ 完整的i18n支持

### 用户流程
- ✅ 新用户：自动进入初始化流程
- ✅ 现有用户：直接进入登录界面
- ✅ 灵活的WebDAV配置（可选）
- ✅ 清晰的步骤指示和错误处理

## 注意事项

1. **WebDAV权限**：首次配置WebDAV时，浏览器会请求跨域权限
2. **密码安全**：主密码用于加密所有数据，请使用强密码
3. **数据同步**：配置WebDAV后，数据会在本地和远程之间同步
4. **初始化状态**：系统会自动检测初始化状态，无需手动管理

## 故障排除

如果遇到问题：

1. 检查浏览器控制台是否有错误信息
2. 确认WebDAV服务器配置正确
3. 检查网络连接和权限设置
4. 清除扩展数据重新初始化

这个初始化流程大大改善了新用户的体验，提供了清晰的设置向导和灵活的同步选项。